---
import Layout from "../../layouts/Layout.astro"; 
import { getCollection } from "astro:content";
import SEO from "../../components/SEO.astro";
import { SITE } from "../../content/config.ts"; // optional DRY base URL

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const {
  title,
  description = "A new post on Crocheo Blog",
  pubDate,
  image = "/images/og-default.jpg",
  tags = [],
} = post.data;

const canonicalUrl = `${SITE}/blog/${post.slug}`;
const formattedDate = new Date(pubDate).toLocaleDateString("en-US", {
  year: "numeric",
  month: "short",
  day: "2-digit",
});
---

<Layout title={title} description={description}>
  <SEO post={post} url={canonicalUrl} />

  <a href="/blog" class="text-blue-600 hover:underline mb-8 inline-block">
    ← All Posts
  </a>

  <header class="mb-4">
    <h1 class="text-4xl font-extrabold text-slate-900 mb-2">{title}</h1>
    <div class="text-slate-500">
      <time datetime={new Date(pubDate).toISOString()}>{formattedDate}</time>
      {tags.length > 0 && <span class="mx-2">·</span>}
      {tags.join(", ")}
    </div>
  </header>

  {image && (
    <img
      src={image}
      alt={title}
      class="w-full rounded-lg my-8"
      loading="lazy"
    />
  )}

  <main class="prose prose-slate lg:prose-xl max-w-none">
    <Content />
  </main>
</Layout>
